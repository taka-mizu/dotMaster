/*! jquery.dotMaster v0.1.1 | (c) 2016  |  */
!function(t,e){"undefined"!=typeof exports?module.exports=e(require("jquery"),t):"function"==typeof define&&define.amd?define(["jquery"],function(){e($,t)}):e($,t)}("undefined"!=typeof window?window:this,function(t,e){!function(){var e,i={},n={},a={};i=function(e,i,n){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.Target=function(){function e(){a(this,e);var i=t("#imgBox");this.img=document.getElementById("test"),this.targetBox=t("#target"),this.startPoint=[],this.endPoint=[],this.imageBoxPosition={x:i.offset().left,y:i.offset().top},this.imageSize={width:this.img.width,height:this.img.height},this.setEvent()}return o(e,[{key:"setEvent",value:function(){var t=this;this.img.ondragstart=function(e){var i={x:e.pageX,y:e.pageY};t.startPoint=t.targetPoint(i,t.imageBoxPosition)},this.img.ondragend=function(e){var i={x:e.pageX,y:e.pageY};t.endPoint=t.targetPoint(i,t.imageBoxPosition),t.createSelectBox({})}}},{key:"targetPoint",value:function(t,e){return{x:t.x-e.x,y:t.y-e.y}}},{key:"createSelectBox",value:function(t){var e=t.target,i=void 0===e?this.targetBox:e,n=t.startPoint,a=void 0===n?this.startPoint:n,o=t.endPoint,r=void 0===o?this.endPoint:o,h=t.imageSize,g=void 0===h?this.imageSize:h,c=(r.x-a.x,r.y-a.y,this.getRectPoint({startPoint:a,endPoint:r})),u=this.getRectSize({startPoint:a,endPoint:r});i.css({width:u.width,height:u.height,borderTopWidth:c.y,borderBottomWidth:g.height-(c.y+u.height),borderLeftWidth:c.x,borderRightWidth:g.width-(c.x+u.width)})}},{key:"getRectPoint",value:function(t){var e=t.startPoint,i=void 0===e?this.startPoint:e,n=t.endPoint,a=void 0===n?this.endPoint:n;if(isNaN(i.x))return{x:0,y:0};var o={x:Math.min(i.x,a.x),y:Math.min(i.y,a.y)};return o}},{key:"getRectSize",value:function(t){var e=t.startPoint,i=void 0===e?this.startPoint:e,n=t.endPoint,a=void 0===n?this.endPoint:n;return isNaN(i.x)?{width:this.imageSize.width,height:this.imageSize.height}:{width:Math.abs(a.x-i.x),height:Math.abs(a.y-i.y)}}},{key:"dragDefault",value:function(t){return!!t.preventDefault&&void t.preventDefault()}}]),e}();return e}(i,a,n),n=function(e,i,n){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.Canvas=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.Canvas=function(){function e(){a(this,e),this.canvas=t("#imageProjector").get(0),this.context=this.canvas.getContext("2d")}return o(e,[{key:"drowImage",value:function(t){var e=t.image,i=t.rectPoint,n=t.rectSize,a={width:e.width,height:e.height};console.log(n,i),this.canvas.width=n.width||a.width,this.canvas.height=n.height||a.height,this.context.drawImage(e,i.x,i.y,n.width,n.height,0,0,n.width,n.height)}},{key:"gray",value:function i(){for(var t={width:this.canvas.width,height:this.canvas.height},e=this.context.getImageData(0,0,t.width,t.height),n=0;n<t.height;n++)for(var a=0;a<t.width;a++){var o=4*(a+n*t.width),r=e.data[o],h=e.data[o+1],g=e.data[o+2],i=(e.data[o+3],(r+h+g)/3);e.data[o]=i,e.data[o+1]=i,e.data[o+2]=i}this.context.putImageData(e,0,0,0,0,t.width,t.height)}},{key:"createDot",value:function(t,e){for(var i=this.canvas.width-this.canvas.width%t,n=this.canvas.height-this.canvas.height%e,a=i/t,o=n/e,r=a*o,h=0,g=0;g<r;g++){var c=g*t%i;h+=0!==g&&0===c?1:0;var u=h*e,d=this.getRangeColors(c,u,t,e),s=this.getRangeColor(d);this.putColor(c,u,t,e,s)}}},{key:"getRangeColors",value:function(t,e,i,n){for(var a=this.context.getImageData(t,e,i,n),o=[],r=0;r<a.data.length;r+=4){var h=a.data[r],g=a.data[r+1],c=a.data[r+2],u=a.data[r+3];o.push({r:h,g:g,b:c,a:u})}return o}},{key:"getRangeColor",value:function(t){for(var e=0,i=0,n=0,a=0;a<t.length;a++)e+=t[a].r,i+=t[a].g,n+=t[a].b;var o={r:Math.floor(e/t.length),g:Math.floor(i/t.length),b:Math.floor(n/t.length)};return o}},{key:"putColor",value:function(t,e,i,n,a){for(var o=this.context.getImageData(0,0,i,n),r=0;r<o.data.length;r+=4)o.data[r]=a.r,o.data[r+1]=a.g,o.data[r+2]=a.b,o.data[r+3]=255;this.context.putImageData(o,t,e)}},{key:"getRangeRandomColor",value:function(t){for(var e=0,i=0,n=0,a=0;a<t.length;a++)e+=t[a].r,i+=t[a].g,n+=t[a].b;var o={r:Math.floor(Math.random()*(e/t.length)),g:Math.floor(Math.random()*(i/t.length)),b:Math.floor(Math.random()*(n/t.length))};return o}}]),e}();return e}(n,a,i),a=function(e,i,n){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.File=void 0;var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();e.File=function(){function e(){var o=this;a(this,e);var r=t("#test"),h=t("#selectfile"),g=t("#dotButton"),c=new i.Canvas,u=new n.Target;g.on("click",function(){c.drowImage({image:r[0],rectPoint:u.getRectPoint({}),rectSize:u.getRectSize({})}),c.createDot(10,10)}),c.drowImage({image:r[0],rectPoint:u.getRectPoint({}),rectSize:u.getRectSize({})}),c.createDot(10,10),h.change(function(){o.encodeImagePath(h.prop("files")[0],function(t){r.attr("src",t),c.drowImage({image:r[0],rectPoint:u.getRectPoint({}),rectSize:u.getRectSize({})}),c.createDot(30,30)})})}return o(e,[{key:"encodeImagePath",value:function(t,e){var i=new FileReader;return t.type.match("image.*")?(i.onload=function(){e(i.result)},void i.readAsDataURL(t)):void e("")}}]),e}();return e}(a,n,i),e=function(t){new t.File}(a)}()});